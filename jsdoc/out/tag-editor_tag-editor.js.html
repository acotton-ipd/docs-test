<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: tag-editor/tag-editor.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: tag-editor/tag-editor.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
* @file tag-editor component
* @author IPDemons
* @description The tag-editor component holds all the business logic for this app.
*/

angular.module('app').component('tagEditor', {

    templateUrl: 'tag-editor/tag-editor.html',
    bindings: {
        groupID: '=groupId'
    },
    controller: function($scope, $firebaseObject, $firebaseArray) {
        this.editmode = true;
        var that = this;
        var rootRef = firebase.database().ref('groups');
/**
* tagsRef Firebase reference to Group's Tags
* @type {string}
*/
        var tagsRef = rootRef.child(that.groupID).child('tags');

/**
* Watch for change in groupID to switch branches in Firebase
* @method $watch
* @description AngularFire method, necessary for 2-way bindings
* @param {string} groupID group ID sent from Home component
*/
        $scope.$watch('$ctrl.groupID', function() {
            tagsRef = rootRef.child(that.groupID).child('tags');
            that.tags = $firebaseArray(tagsRef.orderByChild('order'));
        })

/**
* Save Tag to Firebase
* @param {object} tag Tag object to be saved
*/
        this.saveTag = function(tag) {
/**
* @method $save
* @description AngularFire method saves object to Firebase Ref
*/
            this.tags.$save(tag);
        }

        this.deleteTag = function(tag) {
            var delTag = tag;
            this.tags.$remove(delTag).then((function(data) {
                reorderTags.call(this, delTag.order);
            }).bind(this));

            // var tagID = tag.$id;
            // var tagObj = $firebaseObject(tagsRef.child(tagID));
            //
            // tagObj.$loaded().then(function() {
            //     reorderTagsObject(tagObj.$id);
            //     // tagObj.$remove();
            // });

        };


        function reorderTags(delTagOrder) {
          // create temporary object to hold updated data
          var updates = {};
            for (var i = 0, len = this.tags.length; i &lt; len; i++) {
                if (i >= (delTagOrder - 1)) {
                    // fill the temp object with updated data
                    updates['/'+this.groupID+'/tags/'+this.tags[i].$id+'/order'] = i + 1;
                }
            }
            //a single call to the database updates all data at once
            return rootRef.update(updates);
        }

        this.addNewTag = function() {
            var newOrder = this.tags.length + 1;
            if (this.newTag != "") {
              this.tags.$add({
                  name: this.newTag,
                  order: newOrder
              });
            }
            this.newTag = "";
        }

    }
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-build.html">build</a></li><li><a href="tutorial-component-architecture.html">component-architecture</a></li><li><a href="tutorial-database.html">database</a></li><li><a href="tutorial-documentation.html">documentation</a></li><li><a href="tutorial-firebase-hosting.html">firebase-hosting</a></li><li><a href="tutorial-form-component.html">form-component</a></li><li><a href="tutorial-index_.html">index</a></li><li><a href="tutorial-jsdoc.html">jsdoc</a></li><li><a href="tutorial-misc.html">misc</a></li><li><a href="tutorial-projects-and-trees.html">projects-and-trees</a></li><li><a href="tutorial-toc.html">toc</a></li></ul><h3>Global</h3><ul><li><a href="global.html#$save">$save</a></li><li><a href="global.html#$watch">$watch</a></li><li><a href="global.html#saveTag">saveTag</a></li><li><a href="global.html#templateUrl">templateUrl</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Mon Jan 09 2017 10:04:55 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
